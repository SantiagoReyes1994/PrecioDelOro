<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 4 Avance 5 ARIMA | Precio Del Oro</title>
  <meta name="description" content="Capítulo 4 Avance 5 ARIMA | Precio Del Oro" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 4 Avance 5 ARIMA | Precio Del Oro" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 4 Avance 5 ARIMA | Precio Del Oro" />
  
  
  

<meta name="author" content="Grupo 2: Santiago Reyes, Francisco Santos, Fabian Maldonado" />


<meta name="date" content="2024-06-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="avance-4.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Precio del Oro</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> DATA SET SELECCIONADO</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#nombre-daily-gold-price-2014-2022-time-series-en-kaggle"><i class="fa fa-check"></i><b>1.1</b> NOMBRE: Daily Gold Price (2014-2022) Time Series en Kaggle</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#descripción"><i class="fa fa-check"></i><b>1.2</b> DESCRIPCIÓN:</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#rango-de-fechas01012014-05082022"><i class="fa fa-check"></i><b>1.3</b> RANGO DE FECHAS:01/01/2014-05/08/2022</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#registros-2.227"><i class="fa fa-check"></i><b>1.4</b> REGISTROS: 2.227</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#variables"><i class="fa fa-check"></i><b>1.5</b> VARIABLES:</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#importancia"><i class="fa fa-check"></i><b>1.6</b> IMPORTANCIA:</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="index.html"><a href="index.html#relevancia-económica"><i class="fa fa-check"></i><b>1.6.1</b> <strong>Relevancia económica</strong>:</a></li>
<li class="chapter" data-level="1.6.2" data-path="index.html"><a href="index.html#análisis-de-tendencias"><i class="fa fa-check"></i><b>1.6.2</b> <strong>Análisis de tendencias</strong>:</a></li>
<li class="chapter" data-level="1.6.3" data-path="index.html"><a href="index.html#modelos-de-predicción"><i class="fa fa-check"></i><b>1.6.3</b> <strong>Modelos de predicción</strong>:</a></li>
<li class="chapter" data-level="1.6.4" data-path="index.html"><a href="index.html#investigación-académica"><i class="fa fa-check"></i><b>1.6.4</b> <strong>Investigación académica</strong>:</a></li>
<li class="chapter" data-level="1.6.5" data-path="index.html"><a href="index.html#granularidad-diaria"><i class="fa fa-check"></i><b>1.6.5</b> <strong>Granularidad diaria</strong>:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="propuesta-avance-2-3.html"><a href="propuesta-avance-2-3.html"><i class="fa fa-check"></i><b>2</b> Propuesta Avance 2 &amp; 3</a>
<ul>
<li class="chapter" data-level="2.1" data-path="propuesta-avance-2-3.html"><a href="propuesta-avance-2-3.html#cargar-librerias-a-usar"><i class="fa fa-check"></i><b>2.1</b> Cargar Librerias a usar</a></li>
<li class="chapter" data-level="2.2" data-path="propuesta-avance-2-3.html"><a href="propuesta-avance-2-3.html#cargar-la-data-del-data-set"><i class="fa fa-check"></i><b>2.2</b> Cargar la data del Data set</a></li>
<li class="chapter" data-level="2.3" data-path="propuesta-avance-2-3.html"><a href="propuesta-avance-2-3.html#limpieza-de-datos"><i class="fa fa-check"></i><b>2.3</b> Limpieza de Datos</a></li>
<li class="chapter" data-level="2.4" data-path="propuesta-avance-2-3.html"><a href="propuesta-avance-2-3.html#padding-imputation"><i class="fa fa-check"></i><b>2.4</b> Padding &amp; imputation</a></li>
<li class="chapter" data-level="2.5" data-path="propuesta-avance-2-3.html"><a href="propuesta-avance-2-3.html#exploración-de-la-data"><i class="fa fa-check"></i><b>2.5</b> Exploración de la data</a></li>
<li class="chapter" data-level="2.6" data-path="propuesta-avance-2-3.html"><a href="propuesta-avance-2-3.html#descomposición-de-la-serie-temporal"><i class="fa fa-check"></i><b>2.6</b> Descomposición de la Serie Temporal</a></li>
<li class="chapter" data-level="2.7" data-path="propuesta-avance-2-3.html"><a href="propuesta-avance-2-3.html#análisis-de-estacionalidad"><i class="fa fa-check"></i><b>2.7</b> Análisis de estacionalidad</a></li>
<li class="chapter" data-level="2.8" data-path="propuesta-avance-2-3.html"><a href="propuesta-avance-2-3.html#análisis-de-diferenciación"><i class="fa fa-check"></i><b>2.8</b> Análisis de Diferenciación</a></li>
<li class="chapter" data-level="2.9" data-path="propuesta-avance-2-3.html"><a href="propuesta-avance-2-3.html#transformación-para-controlar-la-tendencia-y-variabilidad"><i class="fa fa-check"></i><b>2.9</b> Transformación para Controlar la Tendencia y Variabilidad</a></li>
<li class="chapter" data-level="2.10" data-path="propuesta-avance-2-3.html"><a href="propuesta-avance-2-3.html#justificación"><i class="fa fa-check"></i><b>2.10</b> Justificación</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="avance-4.html"><a href="avance-4.html"><i class="fa fa-check"></i><b>3</b> Avance 4</a>
<ul>
<li class="chapter" data-level="3.1" data-path="avance-4.html"><a href="avance-4.html#método-de-holt-winters"><i class="fa fa-check"></i><b>3.1</b> Método de Holt-Winters:</a></li>
<li class="chapter" data-level="3.2" data-path="avance-4.html"><a href="avance-4.html#suavizamiento-exponencial"><i class="fa fa-check"></i><b>3.2</b> Suavizamiento Exponencial:</a></li>
<li class="chapter" data-level="3.3" data-path="avance-4.html"><a href="avance-4.html#pronóstico"><i class="fa fa-check"></i><b>3.3</b> Pronóstico:</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="avance-4.html"><a href="avance-4.html#suavizamiento-exponencial-1"><i class="fa fa-check"></i><b>3.3.1</b> Suavizamiento Exponencial:</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="avance-4.html"><a href="avance-4.html#visualización"><i class="fa fa-check"></i><b>3.4</b> Visualización:</a></li>
<li class="chapter" data-level="3.5" data-path="avance-4.html"><a href="avance-4.html#calculando-las-métricas-para-el-suavizamiento-exponencial"><i class="fa fa-check"></i><b>3.5</b> Calculando las métricas para el suavizamiento exponencial</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="avance-5-arima.html"><a href="avance-5-arima.html"><i class="fa fa-check"></i><b>4</b> Avance 5 ARIMA</a>
<ul>
<li class="chapter" data-level="4.1" data-path="avance-5-arima.html"><a href="avance-5-arima.html#pronóstico-con-modelo-arima"><i class="fa fa-check"></i><b>4.1</b> Pronóstico Con Modelo Arima</a></li>
<li class="chapter" data-level="4.2" data-path="avance-5-arima.html"><a href="avance-5-arima.html#evaluación-del-modelo"><i class="fa fa-check"></i><b>4.2</b> Evaluación del Modelo</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="avance-5-arima.html"><a href="avance-5-arima.html#no-autocorrelación"><i class="fa fa-check"></i><b>4.2.1</b> No Autocorrelación</a></li>
<li class="chapter" data-level="4.2.2" data-path="avance-5-arima.html"><a href="avance-5-arima.html#normalidad"><i class="fa fa-check"></i><b>4.2.2</b> Normalidad</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Precio Del Oro</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="avance-5-arima" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Capítulo 4</span> Avance 5 ARIMA<a href="avance-5-arima.html#avance-5-arima" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Como alternativa, haremos el modelo ARIMA. ARIMA es una integración de 2 métodos, AR (Auto Regresión) y MM (Media Móvil). Queremos el método ARIMA teniendo en cuenta nuestros datos de estacionalidad, por lo que usaremos STLM con el método ARIMA.</p>
<p>Dividiremos nuestros datos en entrenamiento y testeo. Tenemos datos de 2014 - 2021 e intentaremos pronosticar el precio de los últimos 6 meses.</p>
<p>6 meses = 7 * 4 * 6 = 168</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="avance-5-arima.html#cb93-1" tabindex="-1"></a><span class="co"># Data de entrenamiento</span></span>
<span id="cb93-2"><a href="avance-5-arima.html#cb93-2" tabindex="-1"></a>train <span class="ot">&lt;-</span> <span class="fu">head</span>(data_ts, <span class="sc">-</span><span class="dv">168</span>)</span>
<span id="cb93-3"><a href="avance-5-arima.html#cb93-3" tabindex="-1"></a><span class="co"># Data de Test</span></span>
<span id="cb93-4"><a href="avance-5-arima.html#cb93-4" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">tail</span>(data_ts, <span class="dv">168</span>)</span>
<span id="cb93-5"><a href="avance-5-arima.html#cb93-5" tabindex="-1"></a></span>
<span id="cb93-6"><a href="avance-5-arima.html#cb93-6" tabindex="-1"></a>gold_arima_stl <span class="ot">&lt;-</span> <span class="fu">stlm</span>(<span class="at">y =</span> train, <span class="at">method =</span> <span class="st">&quot;arima&quot;</span>)</span>
<span id="cb93-7"><a href="avance-5-arima.html#cb93-7" tabindex="-1"></a>gold_arima_stl<span class="sc">$</span>model</span></code></pre></div>
<pre><code>## Series: x 
## ARIMA(2,1,2) 
## 
## Coefficients:
##          ar1      ar2      ma1     ma2
##       0.1980  -0.3136  -0.2090  0.4049
## s.e.  0.2254   0.2368   0.2169  0.2295
## 
## sigma^2 = 76562:  log likelihood = -14490.16
## AIC=28990.33   AICc=28990.36   BIC=29018.47</code></pre>
<div id="pronóstico-con-modelo-arima" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Pronóstico Con Modelo Arima<a href="avance-5-arima.html#pronóstico-con-modelo-arima" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Después de hacer el modelo, intentaremos pronosticar usando nuestros datos de prueba y visualizarlo.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="avance-5-arima.html#cb95-1" tabindex="-1"></a><span class="co"># Pronóstico</span></span>
<span id="cb95-2"><a href="avance-5-arima.html#cb95-2" tabindex="-1"></a>gold_ARIMAforecast <span class="ot">&lt;-</span> <span class="fu">forecast</span>(gold_arima_stl, <span class="at">h =</span> <span class="dv">168</span>)</span>
<span id="cb95-3"><a href="avance-5-arima.html#cb95-3" tabindex="-1"></a></span>
<span id="cb95-4"><a href="avance-5-arima.html#cb95-4" tabindex="-1"></a><span class="co"># Visualización</span></span>
<span id="cb95-5"><a href="avance-5-arima.html#cb95-5" tabindex="-1"></a>data_ts <span class="sc">%&gt;%</span> </span>
<span id="cb95-6"><a href="avance-5-arima.html#cb95-6" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb95-7"><a href="avance-5-arima.html#cb95-7" tabindex="-1"></a>  <span class="fu">autolayer</span>(gold_arima_stl<span class="sc">$</span>fitted, <span class="at">lwd =</span> <span class="fl">0.5</span>, </span>
<span id="cb95-8"><a href="avance-5-arima.html#cb95-8" tabindex="-1"></a>            <span class="at">series =</span> <span class="st">&quot;ARIMA model&quot;</span>) <span class="sc">+</span></span>
<span id="cb95-9"><a href="avance-5-arima.html#cb95-9" tabindex="-1"></a>  <span class="fu">autolayer</span>(gold_ARIMAforecast<span class="sc">$</span>mean, <span class="at">lwd =</span> <span class="fl">0.5</span>,</span>
<span id="cb95-10"><a href="avance-5-arima.html#cb95-10" tabindex="-1"></a>            <span class="at">series =</span> <span class="st">&quot;Forecast 1 year&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<p>En el gráfico podemos ver que la línea roja (modelo ARIMA) con los datos de entrenamiento es bastante similar a nuestros datos originales. Desafortunadamente, la línea azul (Pronóstico) todavía tiene una desviación de los datos originales. Comprobaremos nuestro error con MAPE</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="avance-5-arima.html#cb96-1" tabindex="-1"></a><span class="fu">MAPE</span>(gold_arima_stl<span class="sc">$</span>fitted, train)<span class="sc">*</span><span class="dv">100</span></span></code></pre></div>
<pre><code>## [1] 0.5561707</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="avance-5-arima.html#cb98-1" tabindex="-1"></a><span class="fu">MAPE</span>(gold_ARIMAforecast<span class="sc">$</span>mean, test)<span class="sc">*</span><span class="dv">100</span></span></code></pre></div>
<pre><code>## [1] 4.483968</code></pre>
<p>El error del modelo Arima es de 0.5561707%, y el error del pronóstico es 4.483968%.</p>
</div>
<div id="evaluación-del-modelo" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Evaluación del Modelo<a href="avance-5-arima.html#evaluación-del-modelo" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Después de hacer la predicción, evaluaremos nuestra modelo ARIMA con verificación de suposiciones.</p>
<div id="no-autocorrelación" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> No Autocorrelación<a href="avance-5-arima.html#no-autocorrelación" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>H0: no tiene autocorrelación</p>
<p>H1: tiene autocorrelación</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="avance-5-arima.html#cb100-1" tabindex="-1"></a><span class="co"># ARIMA Model</span></span>
<span id="cb100-2"><a href="avance-5-arima.html#cb100-2" tabindex="-1"></a><span class="fu">Box.test</span>(gold_arima_stl<span class="sc">$</span>residuals, <span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Box-Ljung test
## 
## data:  gold_arima_stl$residuals
## X-squared = 0.0055182, df = 1, p-value = 0.9408</code></pre>
<p>p-value = 0.94 &gt; 0.05 (No correlación)</p>
</div>
<div id="normalidad" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Normalidad<a href="avance-5-arima.html#normalidad" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>H0: Normalmente distribuido</p>
<p>H1: No se sigue una distribución normal</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="avance-5-arima.html#cb102-1" tabindex="-1"></a><span class="fu">shapiro.test</span>(gold_arima_stl<span class="sc">$</span>residuals)</span></code></pre></div>
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  gold_arima_stl$residuals
## W = 0.93835, p-value &lt; 2.2e-16</code></pre>
<p>El p-value &lt; 0,05 (no se distribuye normalmente).</p>
<p>Nuestro modelo falla en la verificación de la normalidad</p>
<p>Avance 7: Facebook Prophet</p>
<p>El modelo Facebook Prophet es una herramienta de código abierto desarrollada por Facebook para el análisis y pronóstico de series temporales.</p>
<p>Primero cargamos la data.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="avance-5-arima.html#cb104-1" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb104-2"><a href="avance-5-arima.html#cb104-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb104-3"><a href="avance-5-arima.html#cb104-3" tabindex="-1"></a></span>
<span id="cb104-4"><a href="avance-5-arima.html#cb104-4" tabindex="-1"></a><span class="co"># Cargar los datos</span></span>
<span id="cb104-5"><a href="avance-5-arima.html#cb104-5" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;Gold Price.csv&quot;</span>)</span></code></pre></div>
<p>Ahora nos aseguramos de instalar y cargar el paquete de prophet.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="avance-5-arima.html#cb105-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;prophet&quot;</span>)</span></code></pre></div>
<pre><code>## Error in install.packages : Updating loaded packages</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="avance-5-arima.html#cb107-1" tabindex="-1"></a><span class="fu">library</span>(prophet)</span></code></pre></div>
<p>Procedemos a preparar los datos. Para esto, verificamos el formato de la columna date.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="avance-5-arima.html#cb108-1" tabindex="-1"></a>data<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(data<span class="sc">$</span>Date)</span></code></pre></div>
<p>Ahora procedemos a renombrar las columnas Date y proce dado que prophet los requiere bajo un formato específco.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="avance-5-arima.html#cb109-1" tabindex="-1"></a>df_prophet <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ds =</span> data<span class="sc">$</span>Date, <span class="at">y =</span> data<span class="sc">$</span>Price)</span>
<span id="cb109-2"><a href="avance-5-arima.html#cb109-2" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">prophet</span>(df_prophet)</span></code></pre></div>
<pre><code>## Disabling daily seasonality. Run prophet with daily.seasonality=TRUE to override this.</code></pre>
<p>Veamos la serie de tiempo original.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="avance-5-arima.html#cb111-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb111-2"><a href="avance-5-arima.html#cb111-2" tabindex="-1"></a></span>
<span id="cb111-3"><a href="avance-5-arima.html#cb111-3" tabindex="-1"></a><span class="co"># Suponiendo que `data` es tu dataframe original con las series de tiempo</span></span>
<span id="cb111-4"><a href="avance-5-arima.html#cb111-4" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> Price)) <span class="sc">+</span></span>
<span id="cb111-5"><a href="avance-5-arima.html#cb111-5" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb111-6"><a href="avance-5-arima.html#cb111-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Fecha&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Precio&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Serie de Tiempo Original&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<p>veamos como prophet se ajusta y predice sobre los valores originales</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="avance-5-arima.html#cb112-1" tabindex="-1"></a><span class="fu">library</span>(prophet)</span>
<span id="cb112-2"><a href="avance-5-arima.html#cb112-2" tabindex="-1"></a></span>
<span id="cb112-3"><a href="avance-5-arima.html#cb112-3" tabindex="-1"></a></span>
<span id="cb112-4"><a href="avance-5-arima.html#cb112-4" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">prophet</span>(df_prophet)</span></code></pre></div>
<pre><code>## Disabling daily seasonality. Run prophet with daily.seasonality=TRUE to override this.</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="avance-5-arima.html#cb114-1" tabindex="-1"></a>future <span class="ot">&lt;-</span> <span class="fu">make_future_dataframe</span>(m, <span class="at">periods =</span> <span class="dv">365</span>)</span>
<span id="cb114-2"><a href="avance-5-arima.html#cb114-2" tabindex="-1"></a>forecast <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, future)</span></code></pre></div>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="avance-5-arima.html#cb115-1" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">merge</span>(df_prophet, forecast[, <span class="fu">c</span>(<span class="st">&quot;ds&quot;</span>, <span class="st">&quot;yhat&quot;</span>, <span class="st">&quot;yhat_lower&quot;</span>, <span class="st">&quot;yhat_upper&quot;</span>)], <span class="at">by =</span> <span class="st">&quot;ds&quot;</span>, <span class="at">all =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="avance-5-arima.html#cb116-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb116-2"><a href="avance-5-arima.html#cb116-2" tabindex="-1"></a></span>
<span id="cb116-3"><a href="avance-5-arima.html#cb116-3" tabindex="-1"></a><span class="co"># Graficar serie de tiempo original y predicciones</span></span>
<span id="cb116-4"><a href="avance-5-arima.html#cb116-4" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> ds)) <span class="sc">+</span></span>
<span id="cb116-5"><a href="avance-5-arima.html#cb116-5" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y, <span class="at">color =</span> <span class="st">&quot;Original&quot;</span>)) <span class="sc">+</span>  </span>
<span id="cb116-6"><a href="avance-5-arima.html#cb116-6" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> yhat, <span class="at">color =</span> <span class="st">&quot;Predicción&quot;</span>)) <span class="sc">+</span></span>
<span id="cb116-7"><a href="avance-5-arima.html#cb116-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Fecha&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Precio&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Serie de Tiempo Original con Predicciones de Prophet&quot;</span>) <span class="sc">+</span></span>
<span id="cb116-8"><a href="avance-5-arima.html#cb116-8" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;Original&quot;</span> <span class="ot">=</span> <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;Predicción&quot;</span> <span class="ot">=</span> <span class="st">&quot;red&quot;</span>)) <span class="sc">+</span></span>
<span id="cb116-9"><a href="avance-5-arima.html#cb116-9" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 365 rows containing missing values or values outside the scale range
## (`geom_line()`).</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
<p>En general, es claro que el prophet predice bastante bien sobre los valores reales, no obstante procedemos a calcular métricas de precisión</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="avance-5-arima.html#cb118-1" tabindex="-1"></a>mae <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(forecast<span class="sc">$</span>yhat <span class="sc">-</span> df_prophet<span class="sc">$</span>y))</span></code></pre></div>
<pre><code>## Warning in forecast$yhat - df_prophet$y: longer object length is not a multiple of shorter
## object length</code></pre>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="avance-5-arima.html#cb120-1" tabindex="-1"></a>rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((forecast<span class="sc">$</span>yhat <span class="sc">-</span> df_prophet<span class="sc">$</span>y)<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## Warning in forecast$yhat - df_prophet$y: longer object length is not a multiple of shorter
## object length</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="avance-5-arima.html#cb122-1" tabindex="-1"></a>mape <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>((df_prophet<span class="sc">$</span>y <span class="sc">-</span> forecast<span class="sc">$</span>yhat) <span class="sc">/</span> df_prophet<span class="sc">$</span>y)) <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div>
<pre><code>## Warning in df_prophet$y - forecast$yhat: longer object length is not a multiple of shorter
## object length</code></pre>
<pre><code>## Warning in (df_prophet$y - forecast$yhat)/df_prophet$y: longer object length is not a multiple
## of shorter object length</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="avance-5-arima.html#cb125-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;MAE:&quot;</span>, mae, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## MAE: 3956.107</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="avance-5-arima.html#cb127-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;RMSE:&quot;</span>, rmse, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## RMSE: 8746.385</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="avance-5-arima.html#cb129-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;MAPE:&quot;</span>, mape, <span class="st">&quot;%</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## MAPE: 13.69306 %</code></pre>
<p>MAPE de aproximadamente 13.69306 % indica que las predicciones del modelo Prophet tienen un error absoluto promedio del 13.69306 % respecto a los valores reales. Es una medida relativa que proporciona una perspectiva sobre la magnitud del error en relación con el tamaño de los valores reales. En conclusión el modelo presenta una precisión “decente”</p>
<p>Una vez ajustado y evaluado el prophet podemos proceder a realizar una predicción sobre 12 años.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="avance-5-arima.html#cb131-1" tabindex="-1"></a>future <span class="ot">&lt;-</span> <span class="fu">make_future_dataframe</span>(m, <span class="at">periods =</span> <span class="dv">12</span> <span class="sc">*</span> <span class="dv">12</span>, <span class="at">freq =</span> <span class="st">&quot;month&quot;</span>)</span>
<span id="cb131-2"><a href="avance-5-arima.html#cb131-2" tabindex="-1"></a>forecast <span class="ot">&lt;-</span> <span class="fu">predict</span>(m, future)</span></code></pre></div>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="avance-5-arima.html#cb132-1" tabindex="-1"></a><span class="fu">plot</span>(m, forecast)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="avance-5-arima.html#cb133-1" tabindex="-1"></a>predicted_values <span class="ot">&lt;-</span> forecast<span class="sc">$</span>yhat</span>
<span id="cb133-2"><a href="avance-5-arima.html#cb133-2" tabindex="-1"></a></span>
<span id="cb133-3"><a href="avance-5-arima.html#cb133-3" tabindex="-1"></a><span class="co"># Calcular MAE, RMSE y MAPE</span></span>
<span id="cb133-4"><a href="avance-5-arima.html#cb133-4" tabindex="-1"></a>mae <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(predicted_values <span class="sc">-</span> df_prophet<span class="sc">$</span>y))</span></code></pre></div>
<pre><code>## Warning in predicted_values - df_prophet$y: longer object length is not a multiple of shorter
## object length</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="avance-5-arima.html#cb135-1" tabindex="-1"></a>rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((predicted_values <span class="sc">-</span> df_prophet<span class="sc">$</span>y)<span class="sc">^</span><span class="dv">2</span>))</span></code></pre></div>
<pre><code>## Warning in predicted_values - df_prophet$y: longer object length is not a multiple of shorter
## object length</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="avance-5-arima.html#cb137-1" tabindex="-1"></a>mape <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>((df_prophet<span class="sc">$</span>y <span class="sc">-</span> predicted_values) <span class="sc">/</span> df_prophet<span class="sc">$</span>y)) <span class="sc">*</span> <span class="dv">100</span></span></code></pre></div>
<pre><code>## Warning in df_prophet$y - predicted_values: longer object length is not a multiple of shorter
## object length</code></pre>
<pre><code>## Warning in (df_prophet$y - predicted_values)/df_prophet$y: longer object length is not a
## multiple of shorter object length</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="avance-5-arima.html#cb140-1" tabindex="-1"></a><span class="co"># Imprimir métricas</span></span>
<span id="cb140-2"><a href="avance-5-arima.html#cb140-2" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;MAE:&quot;</span>, mae, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## MAE: 2566.707</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="avance-5-arima.html#cb142-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;RMSE:&quot;</span>, rmse, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## RMSE: 7500.98</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="avance-5-arima.html#cb144-1" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;MAPE:&quot;</span>, mape, <span class="st">&quot;%</span><span class="sc">\n</span><span class="st">&quot;</span>)</span></code></pre></div>
<pre><code>## MAPE: 8.330445 %</code></pre>
<p>En general la predicción presenta métricas “buenas” podemos ver que este algoritmo es fácil de usar y permite generar rápidamente predicciones que difieren de la típica regresión lineal estándar. Además es especialmente diseñada para predecir sobre intervalos temporales lo cual le da un valor agregado. Las predicciones, presentan un MAPE inferior a 14% en general lo cual podría ser considerado un “éxito”.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="avance-4.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/SantiagoReyes1994/PrecioDelOro/edit/main/Capitulo-4.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/SantiagoReyes1994/PrecioDelOro/blob/main/Capitulo-4.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
